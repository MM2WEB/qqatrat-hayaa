<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اتصل بنا واقتراحاتك - قطرة حياة</title>
     <!-- CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon" href="ChatGPT Image 25 أبريل 2025، 10_18_20 م.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

    <header class="site-header">
        <div class="container">
            <div class="logo">
                <a href="index.html"><i class="fa-solid fa-droplet"></i> قطرة حياة</a>
            </div>
            <nav class="main-nav">
                 <ul>
                    <li><a href="index.html">الرئيسية</a></li>
                    <li><a href="register.html">تسجيل متبرع</a></li>
                    <li><a href="search.html">البحث عن متبرع</a></li>
                    <li><a href="advice.html">نصائح طبية</a></li>
                    <li><a href="about.html">عن المبادرة</a></li>
                    <li><a href="suggestions.html" class="active">اتصل بنا</a></li>
                </ul>
            </nav>
             <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
                <i class="fa-solid fa-bars"></i>
            </button>
        </div>
    </header>

    <main class="section">
        <div class="container">
             <div class="form-section">
                 <h2 class="text-center mb-3">تواصل معنا</h2>
                 <p class="text-center mb-5" style="color: var(--text-light);">نقدر اهتمامك! سواء كان لديك اقتراح لتطوير المنصة، استفسار، أو بلاغ عن مشكلة، نرحب برسالتك ونسعى للرد في أقرب وقت ممكن.</p>

                 <form id="suggestion-form"> <!-- Added ID -->
                    <div class="form-group">
                        <label for="sug_name"><i class="fa-solid fa-user"></i> الاسم (اختياري):</label>
                        <input type="text" id="sug_name" name="sug_name" class="form-control" placeholder="اسمك الكريم">
                    </div>
                     <div class="form-group">
                        <label for="sug_email"><i class="fa-solid fa-envelope"></i> البريد الإلكتروني (اختياري - للرد إن لزم الأمر):</label>
                        <input type="email" id="sug_email" name="sug_email" class="form-control" placeholder="بريدك الإلكتروني (مثال: user@example.com)">
                    </div>
                     <div class="form-group">
                        <label for="sug_subject"><i class="fa-solid fa-lightbulb"></i> الموضوع:</label>
                        <input type="text" id="sug_subject" name="sug_subject" class="form-control" required placeholder="عنوان رسالتك (مثال: اقتراح، استفسار، مشكلة)">
                    </div>
                     <div class="form-group">
                        <label for="sug_message"><i class="fa-solid fa-comment-dots"></i> الرسالة:</label>
                        <textarea id="sug_message" name="sug_message" class="form-control" rows="5" required placeholder="اكتب تفاصيل رسالتك هنا..."></textarea>
                    </div>
                     <div class="text-center mt-4">
                        <button type="submit" class="btn btn-primary btn-lg"><i class="fa-solid fa-paper-plane"></i> إرسال الرسالة</button>
                    </div>
                     <!-- Feedback area -->
                    <div id="suggestion-feedback" class="form-feedback-area"></div>
                </form>

             </div>

              <!-- Optional: Add other contact methods -->
            <div class="text-center mt-5" style="line-height: 1.8;">
                <h4 style="color: var(--text-dark);">للتواصل المباشر أو الاستفسارات العاجلة:</h4>
                <p><i class="fa-solid fa-envelope text-secondary" style="margin-left: 5px;"></i>البريد الإلكتروني: <a href="mailto:mtsmaljylany52@gmail.com" class="text-secondary">mtsmaljylany52@gmail.com</a></p>
                <!-- Add WhatsApp or other links if available -->
                <!-- <p><i class="fa-brands fa-whatsapp text-secondary" style="margin-left: 5px;"></i> واتساب: <a href="https://wa.me/YOUR_NUMBER" target="_blank" class="text-secondary"> اضغط هنا </a></p> -->
                 <p style="font-size: 0.9em; color: var(--text-light);">نفضل استخدام نموذج التواصل أعلاه للاقتراحات والمشاكل التقنية.</p>
            </div>

        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
             <p>موقع قطرة حياة الخيري © <span id="year"></span> - مبادرة تطوعية لإنقاذ الأرواح.</p>
            <p class="footer-credits">فكرة وتصميم: المبرمج معتصم عبدالله محمود الجيلاني | الدكتور محمد عبدوه الجيلاني.</p>
            <p class="footer-supervision"><i class="fa-solid fa-university"></i> تحت إشراف: المعهد الوطني للعلوم والتكنولوجيا</p>
             <p><a href="privacy.html">سياسة الخصوصية وشروط الاستخدام</a></p>
        </div>
    </footer>

    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Your Custom JS Code for Suggestions -->
    <script>
        // =======================================
        // Supabase Initialization (!!! MUST BE FIRST !!!)
        // =======================================
        const SUPABASE_URL = 'https://zohlhmkwntwksjwmjaeh.supabase.co'; // تأكد من صحة الرابط
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpvaGxobWt3bnR3a3Nqd21qYWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwODQzMjksImV4cCI6MjA2MDY2MDMyOX0.T_kUouU6pIaYIj1ChE7AQFREF11CxfSRlKeOvlld8i8';     // Supabase Initialization (!!! MUST BE FIRST !!!)

        let supabaseClient; // Declare supabase client variable

        try {
            if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
                throw new Error("Supabase URL or Anon Key is missing.");
            }
            // Initialize the supabase client
            supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('Supabase Client Initialized for Suggestions Page:', supabaseClient);

        } catch (error) {
             console.error("Error initializing Supabase:", error);
             alert("خطأ فادح: لا يمكن الاتصال بقاعدة البيانات. يرجى المحاولة لاحقاً أو الاتصال بالدعم.");
             const suggestionFormElement = document.getElementById('suggestion-form');
             if (suggestionFormElement) suggestionFormElement.style.display = 'none';
             const feedbackArea = document.getElementById('suggestion-feedback');
             if(feedbackArea) feedbackArea.innerHTML = '<p class="alert alert-danger">تعذر تهيئة الاتصال بقاعدة البيانات.</p>';
        }

        // =======================================
        // Suggestion Form Logic (Comes AFTER initialization)
        // =======================================
        if (supabaseClient) { // Only run if initialization was successful
            const suggestionForm = document.getElementById('suggestion-form');
            const submitButton = suggestionForm.querySelector('button[type="submit"]');
            const feedbackDiv = document.getElementById('suggestion-feedback');

            suggestionForm.addEventListener('submit', async (event) => {
                event.preventDefault();

                const originalButtonText = submitButton.innerHTML;
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> جاري الإرسال...';
                feedbackDiv.innerHTML = ''; // Clear previous feedback

                const formData = new FormData(suggestionForm);
                const suggestionData = {
                    name: formData.get('sug_name') || null, // Handle optional field
                    email: formData.get('sug_email') || null, // Handle optional field
                    subject: formData.get('sug_subject'),
                    message: formData.get('sug_message'),
                    // Ensure 'suggestions' table exists in Supabase with columns:
                    // name (text, nullable), email (text, nullable), subject (text), message (text), created_at (timestamp default now()), status (text default 'new')
                    // Also, ensure RLS policy allows public inserts.
                };

                // Basic Validation (HTML5 'required' handles subject/message)
                if (!suggestionData.subject || !suggestionData.message) {
                     feedbackDiv.innerHTML = `<p class="alert alert-warning">الرجاء ملء حقلي الموضوع والرسالة.</p>`;
                     submitButton.disabled = false;
                     submitButton.innerHTML = originalButtonText;
                     return;
                }

                // Optional: Simple email format check if email is provided
                const emailInput = formData.get('sug_email');
                if (emailInput && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput)) {
                    feedbackDiv.innerHTML = `<p class="alert alert-warning">الرجاء إدخال عنوان بريد إلكتروني صالح أو تركه فارغاً.</p>`;
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    return;
                }


                console.log("Suggestions Page: Sending suggestion:", suggestionData);

                try {
                    // Use the initialized supabaseClient
                    // Ensure RLS on 'suggestions' table allows INSERT for anon key
                    const { data, error } = await supabaseClient
                        .from('suggestions') // Target the suggestions table
                        .insert([suggestionData])
                        .select(); // Return the inserted data or error

                    if (error) {
                        console.error('Suggestions Page: Error sending suggestion:', error);
                        if (error.code === '42501') { // RLS Error
                             feedbackDiv.innerHTML = `<p class="alert alert-danger">خطأ في الأذونات: لا يمكن إرسال الرسالة حالياً. (${error.message})</p>`;
                             console.error("RLS Policy might be blocking INSERT operation on suggestions table.");
                        } else {
                             feedbackDiv.innerHTML = `<p class="alert alert-danger">حدث خطأ أثناء إرسال الرسالة. (${error.message})</p>`;
                        }
                    } else {
                        console.log('Suggestions Page: Suggestion sent successfully:', data);
                        feedbackDiv.innerHTML = `<p class="alert alert-success"><strong>تم إرسال رسالتك بنجاح!</strong> شكراً لتواصلك معنا، سنراجع رسالتك في أقرب فرصة.</p>`;
                        suggestionForm.reset(); // Clear the form on success
                    }

                } catch (catchError) {
                    console.error('Suggestions Page: Unexpected error:', catchError);
                    feedbackDiv.innerHTML = `<p class="alert alert-danger">حدث خطأ غير متوقع. (${catchError.message})</p>`;
                } finally {
                     submitButton.disabled = false;
                     submitButton.innerHTML = originalButtonText;
                }
            });
        } else {
             console.error("Suggestions Page: Supabase client not available. Suggestion functionality disabled.");
             const feedbackArea = document.getElementById('suggestion-feedback');
             if(feedbackArea) feedbackArea.innerHTML = `<p class="alert alert-danger">تعذر تحميل نموذج التواصل بسبب خطأ في الاتصال. يرجى المحاولة مرة أخرى لاحقاً.</p>`;
             const suggestionFormElement = document.getElementById('suggestion-form');
             if (suggestionFormElement) suggestionFormElement.style.display = 'none';
        }

    </script>

     <!-- Shared JavaScript -->
    <script src="script.js" defer></script>

</body>
</html>